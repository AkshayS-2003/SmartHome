{#{% extends 'index.html' %}#}
{#{% block body %}#}
{##}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <title>Reply for the Complaint</title>#}
{#</head>#}
{#<body>#}
{#<h1> Send Reply</h1><form action="/myapp/admin_reply_post/" method="post">#}
{#    {% csrf_token %}#}
{#    <input type="hidden" name="id" value="{{ data.id }}">#}
{##}
{#    <label for="reply">Enter Reply</label>#}
{#    <input type="text" id="reply" name="reply" required>#}
{##}
{#    <button type="submit">Send</button>#}
{#</form>#}
{##}
{#</body>#}
{#</html>#}

{##}


{% extends 'index.html' %}
{% block body %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reply to Complaint</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --success-color: #2ec4b6;
            --warning-color: #ff9e00;
            --danger-color: #e63946;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .reply-container {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header-section {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header-section:before {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(30deg);
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header-icon {
            background: rgba(255, 255, 255, 0.2);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 32px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .header-section h1 {
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        .header-section p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .complaint-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 25px;
            border-left: 5px solid var(--warning-color);
        }

        .detail-row {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-row:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #495057;
            min-width: 150px;
            display: flex;
            align-items: center;
        }

        .detail-label i {
            margin-right: 10px;
            color: var(--primary-color);
            width: 20px;
        }

        .detail-value {
            color: #333;
            flex: 1;
            line-height: 1.5;
        }

        .form-section {
            padding: 0 25px 25px;
        }

        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .form-label i {
            margin-right: 10px;
            color: var(--success-color);
        }

        .form-control {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            font-size: 1rem;
            transition: all 0.3s;
            min-height: 120px;
            resize: vertical;
        }

        .form-control:focus {
            border-color: var(--success-color);
            box-shadow: 0 0 0 0.25rem rgba(46, 196, 182, 0.25);
        }

        .form-control.is-invalid {
            border-color: var(--danger-color);
        }

        .form-control.is-valid {
            border-color: var(--success-color);
        }

        .character-count {
            text-align: right;
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .character-count.warning {
            color: var(--warning-color);
        }

        .character-count.danger {
            color: var(--danger-color);
        }

        .validation-message {
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--success-color) 0%, #1ea896 100%);
            border: none;
            color: white;
            padding: 16px 40px;
            font-weight: 600;
            border-radius: 10px;
            transition: all 0.3s;
            font-size: 1.1rem;
            width: 100%;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, #1ea896 0%, #1a8c7d 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 196, 182, 0.3);
        }

        .btn-submit:active {
            transform: translateY(0);
        }

        .btn-submit:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            text-decoration: none;
            text-align: center;
        }

        .btn-cancel:hover {
            background: #5a6268;
            color: white;
        }

        .template-buttons {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--accent-color);
        }

        .template-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .template-title i {
            margin-right: 10px;
            color: var(--accent-color);
        }

        .template-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .btn-template {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            font-size: 0.9rem;
            text-align: left;
            transition: all 0.2s;
            cursor: pointer;
            color: #495057;
        }

        .btn-template:hover {
            background: #e9ecef;
            border-color: var(--accent-color);
            color: #212529;
        }

        .alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            min-width: 300px;
        }

        @media (max-width: 768px) {
            .reply-container {
                margin: 20px;
            }

            .header-section, .complaint-details, .form-section {
                padding: 20px;
            }

            .detail-row {
                flex-direction: column;
            }

            .detail-label {
                min-width: auto;
                margin-bottom: 5px;
            }

            .template-buttons-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Alert Container -->
    <div class="alert-container"></div>

    <div class="reply-container">
        <!-- Header Section -->
        <div class="header-section">
            <div class="header-content">
                <div class="header-icon">
                    <i class="fas fa-reply"></i>
                </div>
                <h1>Complaint Response</h1>
                <p>Craft a professional reply to address user concerns</p>
            </div>
        </div>

        <!-- Complaint Details Section -->
        <div class="complaint-details">
            <h4 class="mb-4"><i class="fas fa-file-alt me-2"></i>Complaint Details</h4>

            <div class="detail-row">
                <div class="detail-label">
                    <i class="fas fa-hashtag"></i>Complaint ID
                </div>
                <div class="detail-value">
                    #{{ data.id|stringformat:"06d" }}
                </div>
            </div>

            {% if data.user %}
            <div class="detail-row">
                <div class="detail-label">
                    <i class="fas fa-user"></i>Submitted By
                </div>
                <div class="detail-value">
                    {{ data.user.name|default:"User" }}
                </div>
            </div>
            {% endif %}

            {% if data.date %}
            <div class="detail-row">
                <div class="detail-label">
                    <i class="fas fa-calendar-alt"></i>Date Submitted
                </div>
                <div class="detail-value">
                    {{ data.date }}
                </div>
            </div>
            {% endif %}

            {% if data.subject %}
            <div class="detail-row">
                <div class="detail-label">
                    <i class="fas fa-tag"></i>Subject
                </div>
                <div class="detail-value">
                    {{ data.subject }}
                </div>
            </div>
            {% endif %}

            {% if data.complaint %}
            <div class="detail-row">
                <div class="detail-label">
                    <i class="fas fa-comment-dots"></i>Original Complaint
                </div>
                <div class="detail-value">
                    {{ data.complaint }}
                </div>
            </div>
            {% endif %}

            {% if data.status %}
            <div class="detail-row">
                <div class="detail-label">
                    <i class="fas fa-info-circle"></i>Current Status
                </div>
                <div class="detail-value">
                    <span class="badge
                        {% if data.status == 'pending' %}bg-warning
                        {% elif data.status == 'in_progress' %}bg-info
                        {% elif data.status == 'resolved' %}bg-success
                        {% else %}bg-secondary{% endif %}">
                        {{ data.status|title }}
                    </span>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Response Form -->
        <div class="form-section">
            <form action="/myapp/admin_reply_post/" method="post" id="replyForm">
                {% csrf_token %}
                <input type="hidden" name="id" value="{{ data.id }}">

                <div class="mb-4">
                    <label for="reply" class="form-label">
                        <i class="fas fa-edit"></i>Your Response
                    </label>
                    <textarea id="reply" name="reply" class="form-control"
                              placeholder="Type your response here. Be clear, professional, and address all concerns raised in the complaint..."
                              rows="6" required></textarea>
                    <div class="character-count" id="charCount">0/1000 characters</div>
                    <div class="validation-message text-danger" id="replyError">
                        Response must be between 20 and 1000 characters
                    </div>
                </div>

                <!-- Template Buttons -->
                <div class="template-buttons">
                    <div class="template-title">
                        <i class="fas fa-bolt"></i>Quick Response Templates
                    </div>
                    <div class="template-buttons-grid">
                        <button type="button" class="btn-template" onclick="useTemplate('acknowledge')">
                            <i class="fas fa-check-circle me-2 text-success"></i>Acknowledge Complaint
                        </button>
                        <button type="button" class="btn-template" onclick="useTemplate('investigating')">
                            <i class="fas fa-search me-2 text-info"></i>Investigating Issue
                        </button>
                        <button type="button" class="btn-template" onclick="useTemplate('resolved')">
                            <i class="fas fa-thumbs-up me-2 text-primary"></i>Issue Resolved
                        </button>
                        <button type="button" class="btn-template" onclick="useTemplate('apology')">
                            <i class="fas fa-handshake me-2 text-warning"></i>Sincere Apology
                        </button>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <a href="javascript:history.back()" class="btn-cancel">
                        <i class="fas fa-arrow-left me-2"></i>Cancel
                    </a>
                    <button type="submit" class="btn-submit" id="submitBtn">
                        <i class="fas fa-paper-plane"></i>Send Response
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Form Validation Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const replyForm = document.getElementById('replyForm');
            const replyTextarea = document.getElementById('reply');
            const charCount = document.getElementById('charCount');
            const replyError = document.getElementById('replyError');
            const submitBtn = document.getElementById('submitBtn');

            // Character counter
            replyTextarea.addEventListener('input', function() {
                const length = this.value.length;
                charCount.textContent = `${length}/1000 characters`;

                // Update character count color based on length
                if (length >= 950 && length <= 1000) {
                    charCount.className = 'character-count warning';
                } else if (length > 1000) {
                    charCount.className = 'character-count danger';
                } else {
                    charCount.className = 'character-count';
                }

                // Validate length
                validateReply();
            });

            // Form validation function
            function validateReply() {
                const reply = replyTextarea.value.trim();
                const isValid = reply.length >= 20 && reply.length <= 1000;

                if (reply.length > 0 && !isValid) {
                    replyTextarea.classList.add('is-invalid');
                    replyError.style.display = 'block';
                    submitBtn.disabled = true;
                } else {
                    replyTextarea.classList.remove('is-invalid');
                    replyTextarea.classList.add('is-valid');
                    replyError.style.display = 'none';
                    submitBtn.disabled = !isValid;
                }

                return isValid;
            }

            // Initial validation
            validateReply();

            // Form submission handler
            replyForm.addEventListener('submit', function(e) {
                e.preventDefault();

                if (!validateReply()) {
                    showAlert('Please ensure your response is between 20 and 1000 characters.', 'danger');
                    replyTextarea.focus();
                    return;
                }

                // Show loading state
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Sending...';
                submitBtn.disabled = true;

                // Simulate API call delay
                setTimeout(() => {
                    // Show success message
                    showAlert('Response sent successfully!', 'success');

                    // Submit the form after a short delay
                    setTimeout(() => {
                        replyForm.submit();
                    }, 1500);
                }, 1000);
            });

            // Show alert function
            function showAlert(message, type) {
                const alertContainer = document.querySelector('.alert-container');
                const alertId = 'alert-' + Date.now();

                const typeConfig = {
                    'success': { icon: 'fa-check-circle', title: 'Success!' },
                    'danger': { icon: 'fa-exclamation-circle', title: 'Error!' },
                    'warning': { icon: 'fa-exclamation-triangle', title: 'Warning!' },
                    'info': { icon: 'fa-info-circle', title: 'Information' }
                };

                const config = typeConfig[type] || typeConfig.info;

                const alert = document.createElement('div');
                alert.className = `alert alert-${type} alert-dismissible fade show`;
                alert.id = alertId;
                alert.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas ${config.icon} me-3 fs-4"></i>
                        <div class="flex-grow-1">
                            <h6 class="mb-0">${config.title}</h6>
                            <div class="small">${message}</div>
                        </div>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;

                alertContainer.appendChild(alert);

                // Auto-dismiss after 5 seconds
                setTimeout(() => {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }, 5000);
            }

            // Template button handlers
            window.useTemplate = function(templateType) {
                const templates = {
                    'acknowledge': `Dear User,

Thank you for bringing this matter to our attention. We have received your complaint and acknowledge the concerns you've raised.

Our team will review this issue and get back to you with more information shortly.

Best regards,
Support Team`,

                    'investigating': `Dear User,

We are currently investigating the issue you reported. Our technical team is looking into the matter to identify the root cause and find a resolution.

We will provide you with an update within 24-48 hours. Thank you for your patience while we work on this.

Sincerely,
Technical Support`,

                    'resolved': `Dear User,

We are pleased to inform you that the issue you reported has been successfully resolved. Our team has implemented the necessary fixes.

Please let us know if you continue to experience any problems, and we'll be happy to assist further.

Thank you for your cooperation,
Support Team`,

                    'apology': `Dear User,

We sincerely apologize for the inconvenience you've experienced. We understand how frustrating this must be, and we take full responsibility for the issue.

Our team is working diligently to prevent similar situations in the future. We value your feedback and appreciate you giving us the opportunity to make things right.

With apologies,
Customer Service Team`
                };

                const currentText = replyTextarea.value.trim();
                const templateText = templates[templateType] || '';

                // Add template text, preserving existing text if any
                if (currentText && !currentText.includes(templateText.substring(0, 50))) {
                    replyTextarea.value = currentText + '\n\n' + templateText;
                } else if (!currentText.includes(templateText.substring(0, 50))) {
                    replyTextarea.value = templateText;
                }

                // Trigger input event to update character count
                replyTextarea.dispatchEvent(new Event('input'));

                // Show notification
                showAlert('Template applied. Feel free to customize the response.', 'info');

                // Focus on textarea
                replyTextarea.focus();
                replyTextarea.setSelectionRange(replyTextarea.value.length, replyTextarea.value.length);
            };

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + Enter to submit
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    if (!submitBtn.disabled) {
                        replyForm.dispatchEvent(new Event('submit'));
                    }
                }

                // Escape to cancel
                if (e.key === 'Escape') {
                    if (confirm('Are you sure you want to cancel? Any unsaved changes will be lost.')) {
                        window.history.back();
                    }
                }
            });

            // Warn before leaving page if there's unsaved content
            window.addEventListener('beforeunload', function(e) {
                if (replyTextarea.value.trim().length >= 20) {
                    e.preventDefault();
                    e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
                }
            });
        });
    </script>
</body>
</html>

{% endblock %}